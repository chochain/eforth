<html>
  <head>    
  <title>eForth v4.2</title>
  <style>
    .txt { width:96%; display:flex; flex-direction:column; overflow-x:scroll; }
  </style>
  </head>
  <body>
    <div style='display:flex; flex-direction:column; width:100%; height:100%'>
      <pre id='txt' class='txt'></pre>
      <input id='tib' tabindex='0' onkeydown='if (13===event.keyCode) forth_eval()'></input>
    </div>
    <script>
    let txt = document.getElementById('txt')
    let tib = document.getElementById('tib')      
    ///
    /// TextArea handler functions
    ///
    function to_txt(t, br=true) {
        txt.innerHTML += br ? t + '<br/>' : t
        txt.scrollTop = txt.scrollHeight
    }
    function clear_txt() { txt.innerHTML='' }
    ///
    /// WASM ==========================================================
    ///      
    var Module = { print: to_txt }          /// WASM global object
    ///
    /// Forth outer interpreter
    ///
    function forth_eval() {
        let cmd=tib.value.replace(/:/g,'<br/>:')
        if (cmd.indexOf('<br/>')==0) cmd.replace('<br/>','')
        to_txt('<pre class="cmd"><em>'+cmd+'</em></pre>', false)
        try {
            var forth = Module.cwrap('forth', null, ['number', 'string'])
            forth(0, tib.value)            /// * call Forth in C/C++
        }
        catch(e) { console.log(e.toString()+'\n') }
        finally  {                         /// * clear input buffer
            tib.value=''; tib.focus()
        }
    }
    window.onload = ()=>tib.focus()
    </script>
    <script type="text/javascript" src="eforth.js"></script>
  </body>
</html>
